(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4623],{94623:function(e,t,l){"use strict";l.d(t,{Z:function(){return V},F:function(){return Q}});var i=l(85893),a=l(2337),r=l(67294),s=l(58533),n=l(39854),d=l(5266),o=l(11163),u=l(598),c=l(54167),m=l(51879),v=l(9669),h=l.n(v),p=l(33299),g=e=>{var t,l;let{initialImages:i,initialCursor:a,options:s,sortBy:n,filter:d,dateFilter:o}=e,[u,c]=(0,r.useState)(i),[v,g]=(0,r.useState)(a),f=(0,p.useSession)(),[x,j]=(0,r.useState)(!1),b=(0,r.useRef)({sortBy:n,filter:d,dateFilter:o}),y=(0,r.useCallback)(async e=>{var t,l;let{data:{images:i,cursor:a}}=await h().get(s.url,{params:{limit:m.NM,cursor:e,userId:null==f?void 0:null===(l=f.data)||void 0===l?void 0:null===(t=l.user)||void 0===t?void 0:t.id,...s.params}});return{newImages:i,newCursor:a,nasMoreImages:void 0!==e}},[s.params,s.url,null==f?void 0:null===(l=f.data)||void 0===l?void 0:null===(t=l.user)||void 0===t?void 0:t.id]);return(0,r.useEffect)(()=>{var e,t;let l=!1,i=async()=>{j(!0);let{newImages:e,newCursor:t}=await y(0);l||(t&&g(t),c(e),j(!1))};return b.current.sortBy!==n&&(b.current.sortBy=null,i()),b.current.filter!==d&&(b.current.filter=null,i()),((null===(e=b.current.dateFilter)||void 0===e?void 0:e.start)!==(null==o?void 0:o.start)||(null===(t=b.current.dateFilter)||void 0===t?void 0:t.end)!==(null==o?void 0:o.end))&&(b.current.dateFilter=null,i()),()=>{l=!0}},[n,d,null==o?void 0:o.start,null==o?void 0:o.end]),{images:u,getMoreImages:(0,r.useCallback)(async()=>{let{newImages:e,newCursor:t}=await y(v);return t&&g(t),setTimeout(()=>c(t=>[...t,...e]),0),e},[v,y]),haveMoreImages:void 0!==v,setImages:c,showEmptyImages:x}},f=l(41752),x=l(93123),j=l(627),b=l(28456),y=l(92323),w=l(41301),k=l.n(w);function C(e){let{deleteImages:t,numSelected:l}=e,{closeModal:a}=(0,y.d)(),r=(0,f.bJ)();return(0,i.jsxs)(b.Z,{onSubmit:e=>{e.preventDefault(),t()},children:[(0,i.jsx)(b.Z.Header,{children:(0,i.jsx)(b.Z.HeaderTitle,{children:"Are you sure you want to delete ".concat(l," ").concat(l>1?"images":"image","?")})}),(0,i.jsx)(b.Z.Body,{children:"Deleting images will permanently remove them and you will not be able to recover them later."}),(0,i.jsxs)(b.Z.Footer,{children:[(0,i.jsx)(b.Z.Cancel,{onClick:a,disabled:r}),(0,i.jsx)(b.Z.Submit,{className:k().DeleteButton,disabled:r,children:r?(0,i.jsx)(j.ZP,{smallest:!0,flex:!0}):"Delete"})]})]})}function N(e){let{error:t}=e,{closeModal:l}=(0,y.d)();return(0,i.jsxs)(b.Z,{onSubmit:e=>{e.preventDefault(),l()},children:[(0,i.jsx)("div",{className:"flex px-8"}),(0,i.jsx)(b.Z.Header,{children:(0,i.jsx)(b.Z.HeaderTitle,{children:"Cannot complete download"})}),(0,i.jsx)(b.Z.Body,{children:t}),(0,i.jsx)(b.Z.Footer,{children:(0,i.jsx)(b.Z.Submit,{children:"Okay"})})]})}var S=l(86010),Z=l(60422),E=l(13346),L=l(19311),P=l(35893),I=l(62469),T=l(42796);function F(e){let{selectAll:t,allAreSelected:l,allowEdits:a=!0,deletedCallback:r}=e,s=(0,f.dW)(e=>e.active),n=(0,f.Le)(),d=(0,f.uh)(),{setModalContent:o,closeModal:u,isModalOpen:c}=(0,y.d)(),m=e=>{o((0,i.jsx)(N,{error:e}))};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:(0,S.Z)("flex fixed min-w-[600px] left-[50%] -translate-x-[50%] bg-pg-900 p-3 text-sm font-medium rounded-pg-md items-center z-[".concat(x.KN.SELECT_POPOVER,"]"),"border-[1px] border-pg-700","transition-all translate-y-full ease-in-out","shadow-2xl",s?"bottom-20":"-bottom-20"),children:[(0,i.jsxs)("div",{className:"flex items-center ml-1 gap-4 font-semibold text-gray-10",children:[(0,i.jsx)(E.z,{size:"icon",onClick:f.dW.getState().reset,disabled:d||c,children:(0,i.jsx)(Z.Z,{})}),"".concat(n," selected")]}),(0,i.jsx)("div",{className:"flex-grow"}),(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[a&&(0,i.jsx)(E.z,{size:"lg",onClick:()=>{o((0,i.jsx)(C,{deleteImages:()=>{let e=f.dW.getState(),t=e.images.map(e=>e.id);setTimeout(()=>{r(t),u()},300),e.delete()},numSelected:n}))},disabled:0===n||d||c,children:"Delete"}),(0,i.jsx)(E.z,{size:"lg",className:"min-w-[120px]",onClick:()=>{f.dW.getState().download(m)},disabled:0===n||d||c,variant:"create",children:d?(0,i.jsx)(j.ZP,{smallest:!0,flex:!0}):"Download"}),a&&(0,i.jsx)(M,{disabled:0===n||d||c})]})]})})}function M(e){let{disabled:t}=e,l=(0,f.a5)(),[a,s]=(0,r.useState)(null),n=(0,f.dW)(e=>e.images.every(e=>!e.private)),d=(0,f.dW)(e=>e.images.every(e=>e.private)),o=!(0,L.Z)();return(0,i.jsxs)(P.h_,{children:[(0,i.jsx)(P.$F,{disabled:t,asChild:!0,children:(0,i.jsx)(E.z,{size:"icon",children:(0,i.jsx)(I.AjK,{className:"w-4 h-4 "})})}),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(P.AW,{align:"end",side:window.innerWidth>1100?"right":"top",sideOffset:15,alignOffset:window.innerWidth>1100?-27:-10,children:[(0,i.jsxs)(P.Xi,{disabled:l||n,className:"flex items-center disabled:text-gray-50",onClick:()=>{s("public"),f.dW.getState().setPrivacy(!1)},children:["Make public"," ",l&&"public"===a&&(0,i.jsx)(j.ZP,{smallest:!0,flex:!0,className:"ml-2"})]}),(0,i.jsx)(T._,{open:!!o&&!l&&!d&&void 0,label:"This feature is only available to Pro users",mixpanelKey:"Change Privacy (Profile bulk action)",alignOffset:-25,sideOffset:10,children:(0,i.jsxs)(P.Xi,{disabled:l||d,className:"flex items-center disabled:text-gray-50",onClick:()=>{o||(s("private"),f.dW.getState().setPrivacy(!0))},children:["Make private"," ",l&&"private"===a&&(0,i.jsx)(j.ZP,{smallest:!0,flex:!0,className:"ml-2"})]})})]})})]})}var W=l(81810),_=l(21654),D=l(14490),z=l(41664),A=l.n(z),B=l(8891),O=l.n(B),H=l(25675),R=l.n(H),q=l(47922),K=l(1233);function U(e){var t,l,a,r,s;let{data:n}=e,d=(0,q.y)("new-daily-theme-grid-card"),o=(0,D.L)({fallbackData:n});return(0,i.jsx)(A(),{href:"/create",onClick:()=>{var e,t;O().track("Daily Theme Card Clicked",{dailyThemeId:null==o?void 0:null===(e=o.data)||void 0===e?void 0:e.id,dailyThemeTitle:null==o?void 0:null===(t=o.data)||void 0===t?void 0:t.title})},children:(0,i.jsxs)("div",{className:(0,K.cn)("overflow-hidden p-1 rounded-lg relative",d?"bg-pg-600":"bg-gray-75"),children:[(0,i.jsx)("div",{className:(0,K.cn)("absolute top-0 left-0 z-10 p-2 rounded-br-[7px] text-xs font-pg-semibold",d?"bg-pg-600 text-pg-100":"bg-gray-75 text-gray-5"),children:"DAILY THEME"}),(0,i.jsx)("div",{className:"relative",children:(null==o?void 0:null===(t=o.data)||void 0===t?void 0:t.imageUrl)?(0,i.jsx)(R(),{height:400,width:400,src:null==o?void 0:null===(l=o.data)||void 0===l?void 0:l.imageUrl,className:"aspect-square h-full w-full relative rounded-[4px]",alt:null==o?void 0:null===(a=o.data)||void 0===a?void 0:a.title}):null}),(0,i.jsxs)("div",{className:"z-10 relative p-3",children:[(0,i.jsx)("h2",{className:"text-gray-5 font-bold text-sm",children:null==o?void 0:null===(r=o.data)||void 0===r?void 0:r.title}),(0,i.jsx)("p",{className:"text-gray-25 text-sm",children:null==o?void 0:null===(s=o.data)||void 0===s?void 0:s.body})]})]})})}let Q={300:1,440:2,800:3,1200:4,1600:5,3e3:7,3400:8,4e3:9};function V(e){let{className:t,initialImages:l,initialCursor:m,options:v,sortBy:h,filter:p,dateFilter:x,emptyState:j,onScroll:b,groupBatchedImages:w=!1,hideProfileImages:k=!1,scrollThreshold:C=.8,showDailyThemeCard:N,dailyTheme:S}=e,[Z,E]=(0,r.useState)(null),[L,P]=(0,r.useState)(!1),[I,T]=(0,r.useState)(null),M=(0,o.useRouter)(),D="/profile/likes/[id]"===M.pathname,{haveMoreImages:z,getMoreImages:A,setImages:B,images:O,showEmptyImages:H}=g({initialImages:l,initialCursor:m,options:v,sortBy:h,filter:p,dateFilter:x}),{setImageData:R}=(0,c.g)(),{isModalOpen:q,closeModal:K}=(0,y.d)(),V=_.t.useUserHasPermission("moderation:images:private"),X=(0,r.useCallback)(async function(e,t){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];E(t),R(e);let{id:a}=e;M.query.postId=a,i&&M.push(M,"/post/".concat((0,W.Td)(e)),{shallow:!0}),l&&localStorage.setItem("modal-return-to",M.asPath)},[M,R]),J=(0,u.Z)(),Y=(0,r.useMemo)(()=>{let e=[];return O.forEach(t=>{if(t.hide)return;let l=e.find(e=>e.id===t.batchId);l?l.images.length<4&&l.images.push(t):e.push({id:w&&t.batchId?t.batchId:t.id,images:[t]})}),N?[{id:"daily-theme-batch",images:[{id:"daily-theme",isDailyTheme:!0}]},...e]:e},[O,w,N]),$=(0,r.useCallback)(async e=>{if(null!==Z){let a=Z+e;if(N&&0===a)return;let r=N?O.length+1:O.length;if(a>=0&&a<r){var t,l,i;let e=null===(t=Y[a].images)||void 0===t?void 0:t[0];if(null===(i=Y[a].images)||void 0===i?void 0:null===(l=i[0])||void 0===l?void 0:l.id)return X(e,a,!1,!0)}a>=O.length-2&&await A()}},[Y,A,O.length,X,Z,N]);(0,r.useEffect)(()=>f.dW.getState().reset,[]),(0,r.useEffect)(()=>{let e=async e=>{var t;switch(null===(t=e.key)||void 0===t?void 0:t.toLowerCase()){case"arrowleft":case"arrowright":if(!(null==M?void 0:M.query.postId))return;$("ArrowRight"===e.key?1:-1);break;case"shift":console.log("Multi-select: on"),P(!0);break;case"escape":q?K():f.dW.getState().reset()}};document.addEventListener("keydown",e);let t=async e=>{var t;(null===(t=e.key)||void 0===t?void 0:t.toLowerCase())==="shift"&&(console.log("Multi-select: off"),P(!1))};return document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[O,$,null==M?void 0:M.query.postId,Z,q,K]),(0,r.useEffect)(()=>{let e=()=>$(1),t=()=>$(-1);return document.addEventListener("pai:modal:next",e),document.addEventListener("pai:modal:prev",t),()=>{document.removeEventListener("pai:modal:next",e),document.removeEventListener("pai:modal:prev",t)}},[$]);let G=(0,r.useMemo)(()=>O.some(e=>e.hide),[O]),ee=(e,t)=>{B(l=>l.map(l=>t.includes(l.id)?{...l,hide:e}:l))},{width:et}=(0,d.Lm)(),el=(0,r.useMemo)(()=>(0,d.QN)(et,Q),[et]),ei=(0,f.dW)(e=>e.active),ea=(0,f.Le)()===O.length,er=e=>{let{col:t,row:l}=e;return l*el+t},es=(0,r.useMemo)(()=>{let e=-1,t={0:0,1:0,2:0,3:0,4:0};O.length;let l={};return Y.forEach(i=>{let a=(e+=1)%el,r=t[a];t[a]+=2===i.images.length?1:2,i.images.forEach((e,t)=>{l[e.id]={col:a+([1,3].includes(t)?.5:0),row:r+([0,1].includes(t)?0:1)}})}),l},[Y,O.length,el,z]),en=e=>{let t=f.dW.getState();if(!t.downloadLoading&&!t.deleteLoading){if(t.isSelected(e.id))t.deselect(e.id);else{T(e.id);let l={id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas};if(L&&t.images.length&&I){if(L){let l=es[I],i=es[e.id],a=er(l),r=er(i);if(r>a){let l=O.filter(e=>!e.hide).filter(e=>er(es[e.id])>=a&&er(es[e.id])<=r).map(t=>({id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}));t.selectAll([...t.images,...l.filter(e=>!t.images.some(t=>t.id===e.id))])}else if(r<a){let l=O.filter(e=>!e.hide).filter(e=>er(es[e.id])>=r&&er(es[e.id])<=a).map(t=>({id:t.id,url:t.url,prompt:t.prompt,private:t.private,publishedFromCanvas:e.fromCanvas}));t.selectAll([...t.images,...l.filter(e=>!t.images.some(t=>t.id===e.id))])}}}else t.select(l)}}},ed=(0,r.useRef)(null);return J?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Z,{ref:ed,className:t,dataLength:O.length,next:A,hasMore:z,loader:(0,i.jsx)(i.Fragment,{}),style:{overflow:"visible"},scrollThreshold:C,onScroll:()=>{var e;return null==b?void 0:b(null===(e=ed.current)||void 0===e?void 0:e.lastScrollTop)},children:(0,i.jsx)(d.ZP,{columnsCountBreakPoints:Q,children:Y.length&&!H?(0,i.jsx)(a.Z,{gutter:"4px",children:Y.map((e,t)=>{let l=Math.min(e.images.length,2);return(0,i.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"repeat(".concat(l,", minmax(0, 1fr))")},children:e.images.map(e=>{var a,r,s,d;if(e.isDailyTheme)return(0,i.jsx)(U,{data:S},"daily-theme-card");let o=0===t;return(0,i.jsx)(n.F,{highFetchPriority:o,id:e.id,width:e.width,height:e.height,aspectRatio:(null!==(a=e.width)&&void 0!==a?a:1)/(null!==(r=e.height)&&void 0!==r?r:1),prompt:l>1?"":e.prompt,showPrompt:!0,url:e.url,url_jpeg:e.url_jpeg,title:e.title,isPrivate:e.private,createdAt:e.createdAt,source:e.source,user:{id:e.user.id,name:e.user.displayName,avatar:e.user.image},hideImage:k,isLiked:null!==(s=e.userLiked)&&void 0!==s&&s,numLikes:null!==(d=e.likeCount)&&void 0!==d?d:0,fromCanvas:e.fromCanvas,onClick:l=>{if(ei){en(e);return}L&&(console.log("Multi-select: off [2]"),P(!1)),l.metaKey||L||X(e,t)},setHidden:ee,forceVisible:G||o,parent_image_url:e.parent_image_url},e.id)})},e.id)})}):(0,i.jsx)("p",{className:"text-gray-400 p-10",children:j||H||"No images."})})}),(0,i.jsx)(F,{selectAll:()=>{let e=O.map(e=>({id:e.id,url:e.url,prompt:e.prompt,private:e.private,publishedFromCanvas:e.fromCanvas}));f.dW.getState().selectAll(e)},allAreSelected:ea,deletedCallback:e=>ee(!0,e),allowEdits:!D||V})]}):null}},5266:function(e,t,l){"use strict";l.d(t,{Lm:function(){return n},QN:function(){return d}});var i=l(85893),a=l(598),r=l(77690),s=l(67294);let n=()=>{let e=(0,a.Z)(),[t,l]=(0,s.useState)(0),i=(0,s.useCallback)(()=>{e&&l(window.innerWidth)},[e]);return(0,r.L)(()=>{if(e)return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[e,i]),{width:t,hasMounted:e}};function d(e,t){let l=1;return Object.entries(t).sort((e,t)=>{let[l]=e,[i]=t;return parseInt(i)-parseInt(l)}).some(t=>{let[i,a]=t;return e>=parseInt(i)&&(l=a,!0)}),l}t.ZP=e=>{let{columnsCountBreakPoints:t,children:l,className:a,style:r}=e,{width:o,hasMounted:u}=n(),c=(0,s.useMemo)(()=>d(o,t),[t,o]);return(0,i.jsx)("div",{className:a,style:r,children:u?s.Children.map(l,(e,t)=>s.cloneElement(e,{key:t,columnsCount:c})):null})}},41301:function(e){e.exports={DeleteButton:"DeleteCanvas_DeleteButton__6ok_T"}}}]);